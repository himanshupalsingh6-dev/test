<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>QuickPress â€“ My Orders</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
:root{--yellow:#FFD400;--bg:#f6f7f9}
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
  background:var(--bg);
}
.page{padding:18px}
.card{
  background:#fff;
  border-radius:16px;
  padding:14px;
  margin-bottom:12px;
  box-shadow:0 6px 14px rgba(0,0,0,.08);
}
.status{
  display:inline-block;
  padding:4px 10px;
  border-radius:12px;
  font-size:12px;
  font-weight:800;
}
.Placed{background:#fff3cd;color:#856404}
.Ready{background:#d4edda;color:#155724}
.Delivered{background:#d1ecf1;color:#0c5460}
.empty{
  text-align:center;
  margin-top:60px;
  color:#555;
}
.small{
  font-size:13px;
  color:#555;
}
</style>
</head>

<body>

<div class="page">
  <h2>My Orders</h2>
  <div id="orders"></div>
</div>

<!-- ================= FIREBASE ================= -->
<script type="module">
import { initializeApp, getApps } from
"https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import {
  getAuth,
  onAuthStateChanged
} from
"https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
import {
  getFirestore,
  collection,
  query,
  where,
  orderBy,
  getDocs
} from
"https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

/* ðŸ”¥ FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyAWTOu3JBhg3JuZg6snAxhnf_XFhLhLkbc",
  authDomain: "quickpress-web.firebaseapp.com",
  projectId: "quickpress-web",
  storageBucket: "quickpress-web.appspot.com",
  messagingSenderId: "909067547966",
  appId: "1:909067547966:web:fda5e47e1e58ca7ae7a86f"
};

/* SAFE INIT */
const app = getApps().length
  ? getApps()[0]
  : initializeApp(firebaseConfig);

const auth = getAuth(app);
const db = getFirestore(app);

const ordersDiv = document.getElementById("orders");

/* ================= AUTH GUARD ================= */
onAuthStateChanged(auth, async user => {
  if(!user){
    alert("Please login first");
    location.href="customer-login.html";
    return;
  }
  loadOrders(user.uid);
});

/* ================= LOAD ORDERS ================= */
async function loadOrders(uid){
  ordersDiv.innerHTML = "Loading orders...";

  try{
    const q = query(
      collection(db,"orders"),
      where("userId","==",uid),
      orderBy("createdAt","desc")
    );

    const snap = await getDocs(q);

    if(snap.empty){
      ordersDiv.innerHTML =
        `<div class="empty">No orders yet</div>`;
      return;
    }

    ordersDiv.innerHTML = "";

    snap.forEach(doc => {
      const o = doc.data();

      ordersDiv.innerHTML += `
        <div class="card">
          <div class="row">
            <b>Order ID:</b> ${doc.id}
          </div>
          <div class="row small">
            Items: ${o.items.map(i=>`${i.name} Ã— ${i.qty}`).join(", ")}
          </div>
          <div class="row">
            <b>Total:</b> â‚¹${o.grandTotal}
          </div>
          <div class="row">
            <span class="status ${o.status}">${o.status}</span>
          </div>
        </div>
      `;
    });

  }catch(err){
    console.error(err);
    ordersDiv.innerHTML =
      `<div class="empty">Failed to load orders</div>`;
  }
}
</script>

</body>
</html>
