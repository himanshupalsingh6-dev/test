<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>QuickPress â€“ Delivery Partner</title>

<style>
body{margin:0;font-family:Arial;background:#f4f4f4}
.header{
  background:#FFD400;
  padding:14px;
  font-size:22px;
  font-weight:900;
  text-align:center;
}
.card{
  background:#fff;
  margin:14px;
  padding:14px;
  border-radius:12px;
}
input{
  width:100%;
  padding:10px;
  margin:8px 0;
}
button{
  padding:8px 14px;
  border:none;
  border-radius:8px;
  font-weight:800;
  background:#27ae60;
  color:#fff;
}
.order{
  background:#fff;
  margin:10px 0;
  padding:12px;
  border-radius:10px;
}
</style>

<!-- ðŸ”¥ FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import {
  getFirestore, collection, getDocs,
  query, where, updateDoc, doc
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAWTOu3JBhg3JuZg6snAxhnf_XFhLhLkbc",
  authDomain: "quickpress-web.firebaseapp.com",
  projectId: "quickpress-web",
  storageBucket: "quickpress-web.firebasestorage.app",
  messagingSenderId: "909067547966",
  appId: "1:909067547966:web:fda5e47e1e58ca7ae7a86f"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let deliveryId = null;

/* ===== LOGIN ===== */
window.login = async function(){
  const phone = phoneInput.value.trim();
  if(!phone){ alert("Enter phone"); return; }

  const q = query(
    collection(db,"delivery_boys"),
    where("phone","==",phone),
    where("status","==","approved")
  );

  const snap = await getDocs(q);
  if(snap.empty){
    alert("Not approved or not found");
    return;
  }

  deliveryId = snap.docs[0].id;
  loginBox.style.display="none";
  ordersBox.style.display="block";
  loadOrders();
};

/* ===== LOAD ORDERS ===== */
async function loadOrders(){
  ordersList.innerHTML="Loading orders...";
  const snap = await getDocs(collection(db,"orders"));
  ordersList.innerHTML="";

  snap.forEach(d=>{
    const o = d.data();
    if(o.status !== "Accepted") return;

    ordersList.innerHTML += `
      <div class="order">
        <b>Order:</b> ${d.id}<br>
        Amount: â‚¹${o.grandTotal}<br>
        <button onclick="deliver('${d.id}')">Mark Delivered</button>
      </div>
    `;
  });
}

window.deliver = async function(orderId){
  await updateDoc(doc(db,"orders",orderId),{
    status:"Delivered"
  });
  alert("Order delivered");
  loadOrders();
};
</script>
</head>

<body>

<div class="header">Delivery Partner Panel</div>

<!-- LOGIN -->
<div class="card" id="loginBox">
  <h3>Login</h3>
  <input id="phoneInput" placeholder="Enter phone number">
  <button onclick="login()">Login</button>
</div>

<!-- ORDERS -->
<div class="card" id="ordersBox" style="display:none">
  <h3>Orders</h3>
  <div id="ordersList"></div>
</div>

</body>
</html>
