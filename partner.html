<!DOCTYPE html>
<html>
<head>
<title>Partner Panel – QuickPress</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body{margin:0;font-family:Arial;background:#f4f4f4}
.header{
  background:#FFD400;
  padding:14px;
  font-size:20px;
  font-weight:900;
  text-align:center;
}
.card{
  background:#fff;
  margin:12px;
  padding:14px;
  border-radius:12px;
}
button{
  padding:6px 10px;
  border:none;
  border-radius:6px;
  font-weight:800;
  margin-right:6px;
}
</style>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import {
  getFirestore, collection, query, where,
  getDocs, updateDoc, doc
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAWTOu3JBhg3JuZg6snAxhnf_XFhLhLkbc",
  authDomain: "quickpress-web.firebaseapp.com",
  projectId: "quickpress-web"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const email = localStorage.getItem("partnerEmail");
if(!email){
  location.href="login.html";
}

/* LOAD ORDERS */
async function loadOrders(){
  const q = query(
    collection(db,"orders"),
    where("partnerEmail","==",email)
  );

  const snap = await getDocs(q);
  const box = document.getElementById("orders");
  box.innerHTML="";

  snap.forEach(d=>{
    const o=d.data();
    let items="";
    o.items?.forEach(i=>items+=`${i.name} × ${i.qty}<br>`);

    box.innerHTML+=`
      <div class="card">
        <b>Order:</b> ${d.id}<br>
        ${items}
        <b>Status:</b> ${o.partnerStatus || "Assigned"}<br><br>
        <button onclick="updateStatus('${d.id}','Ironed')">Ironed</button>
        <button onclick="updateStatus('${d.id}','Ready')">Ready</button>
      </div>
    `;
  });
}

window.updateStatus = async function(id,status){
  await updateDoc(doc(db,"orders",id),{
    partnerStatus:status
  });
  loadOrders();
};

/* LOAD WALLET */
async function loadWallet(){
  const q=query(
    collection(db,"partners"),
    where("email","==",email)
  );
  const snap=await getDocs(q);
  snap.forEach(d=>{
    wallet.innerText=d.data().wallet || 0;
  });
}

loadOrders();
loadWallet();
</script>
</head>

<body>

<div class="header">Partner Dashboard</div>

<div class="card">
  <b>Wallet:</b> ₹<span id="wallet">0</span>
</div>

<div id="orders"></div>

</body>
</html>
