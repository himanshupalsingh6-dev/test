<!DOCTYPE html>
<html>
<head>
  <title>Admin Dashboard â€“ QuickPress</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body { margin:0; font-family:Segoe UI; background:#f4f6f8; }
    .header { background:linear-gradient(135deg,#ff9800,#ff6f00); color:white; padding:20px; font-size:20px; font-weight:bold; }
    .grid { display:grid; grid-template-columns:repeat(2,1fr); gap:12px; padding:12px; }
    .card { background:white; border-radius:14px; padding:15px; box-shadow:0 2px 10px rgba(0,0,0,0.1); }
    .title { font-size:14px; color:#777; }
    .value { font-size:22px; font-weight:bold; margin-top:5px; }
    .charts { padding:12px; }
    .chart-card { background:white; border-radius:14px; padding:15px; margin-bottom:12px; box-shadow:0 2px 10px rgba(0,0,0,0.1); }
  </style>
</head>
<body>

<div class="header">ðŸ“Š Admin Dashboard</div>

<div class="grid">
  <div class="card"><div class="title">Total Customers</div><div class="value" id="totalCustomers">0</div></div>
  <div class="card"><div class="title">Total Partners</div><div class="value" id="totalPartners">0</div></div>
  <div class="card"><div class="title">Total Delivery Boys</div><div class="value" id="totalDelivery">0</div></div>
  <div class="card"><div class="title">Total Orders</div><div class="value" id="totalOrders">0</div></div>
  <div class="card"><div class="title">Total Revenue</div><div class="value">â‚¹<span id="totalRevenue">0</span></div></div>
</div>

<div class="charts">
  <div class="chart-card"><canvas id="ordersChart"></canvas></div>
  <div class="chart-card"><canvas id="revenueChart"></canvas></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAWTOu3JBhg3JuZg6snAxhnf_XFhLhLkbc",
  authDomain: "quickpress-web.firebaseapp.com",
  projectId: "quickpress-web"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

async function loadData(){
  const usersSnap = await getDocs(collection(db,"users"));
  const partnersSnap = await getDocs(collection(db,"partners"));
  const deliverySnap = await getDocs(collection(db,"delivery"));
  const ordersSnap = await getDocs(collection(db,"orders"));

  document.getElementById("totalCustomers").innerText = usersSnap.size;
  document.getElementById("totalPartners").innerText = partnersSnap.size;
  document.getElementById("totalDelivery").innerText = deliverySnap.size;
  document.getElementById("totalOrders").innerText = ordersSnap.size;

  let revenue = 0;
  let statusCount = {Placed:0,Assigned:0,Accepted:0,Ready:0,Picked:0,Delivered:0};
  let revenueByDay = {};

  ordersSnap.forEach(d=>{
    const o = d.data();
    revenue += Number(o.grandTotal) || 0;

    if(statusCount[o.status] !== undefined){
      statusCount[o.status]++;
    }

    let dateKey = "Today";
    if(o.createdAt?.seconds){
      dateKey = new Date(o.createdAt.seconds*1000).toLocaleDateString();
    }

    revenueByDay[dateKey] = (revenueByDay[dateKey] || 0) + (Number(o.grandTotal) || 0);
  });

  document.getElementById("totalRevenue").innerText = revenue;

  new Chart(document.getElementById("ordersChart"),{
    type:"pie",
    data:{
      labels:Object.keys(statusCount),
      datasets:[{
        data:Object.values(statusCount),
        backgroundColor:["#3498db","#9b59b6","#f1c40f","#e67e22","#1abc9c","#2ecc71"]
      }]
    }
  });

  new Chart(document.getElementById("revenueChart"),{
    type:"line",
    data:{
      labels:Object.keys(revenueByDay),
      datasets:[{
        label:"Revenue",
        data:Object.values(revenueByDay),
        borderColor:"#ff9800",
        fill:false,
        tension:0.3
      }]
    },
    options:{ scales:{ y:{ beginAtZero:true } } }
  });
}

loadData();
</script>

</body>
</html>
