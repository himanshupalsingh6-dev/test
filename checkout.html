<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Checkout</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import {
  getFirestore, collection, addDoc, serverTimestamp
} from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAWTOu3JBhg3JuZg6snAxhnf_XFhLhLkbc",
  authDomain: "quickpress-web.firebaseapp.com",
  projectId: "quickpress-web"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const cart = JSON.parse(localStorage.getItem("cart")||"[]");
let total=0;

window.onload=()=>{
  cart.forEach(i=>{
    list.innerHTML+=`${i.name} × ${i.qty} = ₹${i.price*i.qty}<br>`;
    total+=i.price*i.qty;
  });
  sum.innerText=total;
};

window.place=async()=>{
  if(!name.value||!phone.value||!addr.value){
    alert("Fill address");
    return;
  }
  await addDoc(collection(db,"orders"),{
    items:cart,
    grandTotal:total,
    customer:{
      name:name.value,
      phone:phone.value,
      address:addr.value
    },
    status:"Placed",
    createdAt:serverTimestamp()
  });
  localStorage.removeItem("cart");
  alert("Order placed");
  location.href="index.html";
};
</script>

<body style="font-family:Arial;background:#f4f4f4">

<h2>Checkout</h2>
<div id="list"></div>
<b>Total ₹<span id="sum">0</span></b><br><br>

<input id="name" placeholder="Name"><br><br>
<input id="phone" placeholder="Phone"><br><br>
<textarea id="addr" placeholder="Address"></textarea><br><br>

<button onclick="place()">Place Order</button>

</body>
</html>
