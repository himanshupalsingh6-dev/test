<!DOCTYPE html>
<html>
<head>
<title>Checkout</title>
</head>
<body>

<h2>Checkout</h2>
<p>Total: <span id="total">₹0</span></p>
<button onclick="placeOrder()">Place Order</button>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp } 
from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyAWTOu3JBhg3JuZg6snAxhnf_XFhLhLkbc",
  authDomain: "quickpress-web.firebaseapp.com",
  projectId: "quickpress-web"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

function getCart(){
  return JSON.parse(localStorage.getItem("cart")) || [];
}

function calcTotal(){
  let t=getCart().reduce((s,i)=>s+i.price*i.qty,0);
  return t===0?0:t+20+3;
}

document.getElementById("total").innerText="₹"+calcTotal();

window.placeOrder = async function(){
  let cart=getCart();
  if(cart.length===0){alert("Cart empty");return;}

  await addDoc(collection(db,"orders"),{
    items:cart,
    grandTotal:calcTotal(),
    status:"Placed",
    createdAt:serverTimestamp()
  });

  alert("Order placed");
  localStorage.removeItem("cart");
  location.href="index.html";
};
</script>

</body>
</html>
